План реализации (под Docker Desktop)

Этап 1. Базовая структура проекта и окружение — выполнено
- Проверить текущую структуру /app, привести к рекомендованной (sources, integrations, data, logs).
- Уточнить/обновить Dockerfile и docker-compose.yml для запуска одного сервиса с Python 3.11+.
- Добавить/обновить requirements.txt с зависимостями: playwright, gspread, google-auth, requests, python-dotenv, pytest.
- Обновить README.md с инструкцией запуска только через Docker Desktop и описанием деплоя на сервер (как требует AGENTS).
- Обновить .env.example и .env (с комментариями, где брать доступы).
- Создать каркас main.py и модулей интеграций/источников (без логики).

Этап 2. Конфигурация и вспомогательные модули — выполнено
- Загрузка .env и валидация обязательных переменных.
- Реализация нормализации URL (url_normalize.py).
- Реализация хранилища notified_store (state.py) с JSON и очисткой по sheet_set.
- Реализация нарезки сообщений Telegram по MAX_TELEGRAM_CHARS.

Этап 3. Интеграции — выполнено
- Google Sheets: чтение столбца по имени или индексу, нормализация URL.
- Telegram: отправка сообщений, ретраи 3 попытки с backoff, логирование ответов.

Этап 4. Источник 1 (portugalruncalendar.com) — выполнено
- Реализовать обход пагинации с динамическим поиском ссылок страниц.
- Реализовать сбор event links с основным селектором и fallback.
- Добавить защиту от циклов и max_pages_limit.

Этап 5. Источник 2 (portugalrunning.com) — выполнено
- Реализовать сбор событий с EventON календаря на 13 месяцев.
- Реализовать ожидания после клика "next" (изменение месяца/DOM).

Этап 6. Основной pipeline — выполнено
- Склейка логики: чтение sheet_set, загрузка notified_store, запуск источников, расчет to_notify.
- Формирование сообщений по источникам или единое сообщение.
- Обновление notified_store после успешной отправки.
- Обработка ошибок: независимая деградация источников и корректный exit code.

Этап 7. Тесты — выполнено
- test_url_normalize
- test_chunking_telegram
- test_state_store_roundtrip

Этап 8. Финальная проверка и документация — выполнено
- Проверить, что все параметры доступны через .env.
- Убедиться, что проект запускается только через Docker Desktop.
- Обновить README.md с краткой инструкцией запуска и деплоя на сервер.
